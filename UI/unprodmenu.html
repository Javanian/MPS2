<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNPROD</title>
    <link rel="stylesheet" href="css/style.css" />
</head>

<body>
    <div class="container-vertical" style="margin: 10px ;height: calc(100% - 20px);
        justify-content: flex-start;
        gap: 5px; width:calc(100% - 20px);border:none">
    <div class="container-title-horizontal"
        style="padding: 0px; overflow:hidden;display:flex;align-items:center;justify-content:space-between">
        <div class="button-utama full" onclick="backcuy()" style="max-width: 100px;border-radius: 12px;">
            <img src="css/svg-white/arrow-left-circle.svg">
        </div>
        <div class="button-utama full" style="max-width: 100px;border-radius: 12px;">
          <img src="css/svg-white/repeat.svg"></div>
    </div>
    <div class="button-grid">
    <button onclick="id_unprod('1510', this)">1510 <br> BRIEFING</button>
    <button onclick="id_unprod('1520', this)">1520 COFFEE BREAKS</button>
    <button onclick="id_unprod('1530', this)">1530 HOUSEKEEPING</button>
    <button onclick="id_unprod('1540', this)">1540 TRAINING</button>
    <button onclick="id_unprod('1550', this)">1550 WAITING FOR MATERIAL</button>
    <button onclick="id_unprod('1560', this)">1560 WAITING FOR NCR</button>
    <button onclick="id_unprod('1570', this)">1570 WAITING FOR ENGINEERING</button>
    <button onclick="id_unprod('1580', this)">1580 WAITING FOR INSPECTION</button>
    <button onclick="id_unprod('1590', this)">1590 WAITING FOR HANDLING</button>
    <button onclick="id_unprod('1610', this)">1610 JIGS & FIXTURES</button>
    <button onclick="id_unprod('1620', this)">1620 TOOL PREPARATION</button>
    <button onclick="id_unprod('1630', this)">1630 MAINTENANCE</button>
    <button onclick="id_unprod('1640', this)">1640 LABOUR NECESSITY</button>
    <button onclick="id_unprod('1650', this)">1650 MACHINE / ELECTRICITY BREAKDOWN</button>
    <button onclick="id_unprod('1660', this)">1660 DAILY PM</button>
    <button onclick="id_unprod('1670', this)">1670 WAITING FOR JOB</button>
    <button onclick="id_unprod('1680', this)">1680 OTHERS</button>
    
        </div>
    <script>
        function backcuy() {
  window.location.href = "index";
}
        async function id_unprod(id, btn) {
            try {
                // ----- contoh ambil data user dari sessionStorage -----
                const datakaryawan = JSON.parse(sessionStorage.getItem("datakaryawan")) || {};
                const { snssb, full_name, workcenter, machinename } = datakaryawan;

                // pastikan field penting tidak kosong
                if (!snssb || !full_name) {
                    alert("Data karyawan tidak lengkap!");
                    return;
                }

                const serialnumber = datakaryawan.snssb;
                const checkoutRes = await fetch(
                    `/timesheet/checkout`,
                    {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            datakaryawan: { sn: datakaryawan.snssb },
                        }),
                    }
                );

                
                const operation_text = btn.innerText.trim();

                // 1️⃣ panggil API unprod
                const unprodRes = await fetch("/timesheet/", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        id_unprod: id,
                        serialnumber: datakaryawan.snssb,
                        full_name: datakaryawan.full_name,
                        operation_text: operation_text, // perhatikan underscore
                        workcentercode: datakaryawan.workcenter,
                        workcenterdescription: datakaryawan.machinename,
                    })
                });

                if (!unprodRes.ok) throw new Error("Gagal input unprod");
                 alert("TIMESHEET berhasil!✅");
                    window.location.href = "index";
                

            } catch (err) {
                console.error(err);
                alert("Terjadi kesalahan: " + err.message);
            }
        }
    </script>

</body>

</html>