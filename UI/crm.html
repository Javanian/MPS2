<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSB</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
        }

        .content-container {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .left-panel {
            flex: 1;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .right-panel {
            flex: 1;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .panel-header {
            padding: 15px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .table-list {
            padding: 0;
            list-style: none;
        }

        .table-item {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-item:hover {
            background-color: #f8f9fa;
            transform: translateX(5px);
        }

        .table-item.active {
            background-color: #e3f2fd;
            border-left: 4px solid #2196f3;
            font-weight: 600;
        }

        .table-count {
            background: #2196f3;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            background: #f8f9fa;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: #555;
            border-bottom: 2px solid #dee2e6;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        .data-table tr:hover {
            background-color: #f8f9fa;
        }

        .data-table tr.selected {
            background-color: #e3f2fd;
        }

        .empty-state {
            padding: 40px 20px;
            text-align: center;
            color: #999;
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .relationship-info {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 20px;
        }

        .relationship-info h3 {
            margin-bottom: 10px;
            color: #333;
        }

        .relationship-path {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: 6px;
            margin-bottom: 15px;
        }

        .path-item {
            padding: 5px 12px;
            background: #e3f2fd;
            border-radius: 4px;
            font-weight: 500;
        }

        .path-arrow {
            color: #999;
        }

        .data-details {
            padding: 20px;
        }

        .detail-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .detail-label {
            font-weight: 600;
            color: #666;
            margin-bottom: 5px;
            display: block;
        }

        .detail-value {
            color: #333;
            font-size: 16px;
        }

        .highlight {
            background-color: #fffacd;
            padding: 2px 4px;
            border-radius: 3px;
        }

        @media (max-width: 768px) {
            .content-container {
                flex-direction: column;
            }
            
            .left-panel, .right-panel {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>SSB</h1>
            <p>semakin didepan</p>
        </div>

        <div class="content-container">
            <!-- Left Panel: Table List and Data -->
            <div class="left-panel">
                <div class="panel-header">ðŸ“‹ Database Tables</div>
                <ul class="table-list" id="tableList">
                    <!-- Table list will be populated by JavaScript -->
                </ul>
                
                <div id="tableDataContainer">
                    <div class="empty-state">
                        <div>ðŸ“„</div>
                        <p>Select a table to view its data</p>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Related Data -->
            <div class="right-panel">
                <div class="panel-header" id="rightPanelTitle">ðŸ”— Related Data</div>
                <div id="relatedDataContainer">
                    <div class="empty-state">
                        <div>ðŸ”—</div>
                        <p>Select a record to view related data</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="relationship-info" id="relationshipInfo" style="display: none;">
            <h3>Relationship Path</h3>
            <div class="relationship-path" id="relationshipPath"></div>
        </div>
    </div>

    <script>
        // Sample Data
        const database = {
            quotation: {
                name: "Quotation",
                fields: ["id", "quote_number", "customer_id", "total_amount", "status", "created_date"],
                data: [
                    { id: 1, quote_number: "Q-2024-001", customer_id: 101, total_amount: 15000, status: "Approved", created_date: "2024-01-15" },
                    { id: 2, quote_number: "Q-2024-002", customer_id: 102, total_amount: 23000, status: "Pending", created_date: "2024-01-18" },
                    { id: 3, quote_number: "Q-2024-003", customer_id: 103, total_amount: 18500, status: "Approved", created_date: "2024-01-20" },
                    { id: 4, quote_number: "Q-2024-004", customer_id: 101, total_amount: 32000, status: "Rejected", created_date: "2024-01-22" }
                ],
                relations: {
                    production_order: "quotation_id"
                }
            },
            production_order: {
                name: "Production Order",
                fields: ["id", "order_number", "quotation_id", "start_date", "end_date", "priority", "status"],
                data: [
                    { id: 1, order_number: "PO-2024-001", quotation_id: 1, start_date: "2024-01-20", end_date: "2024-02-20", priority: "High", status: "In Progress" },
                    { id: 2, order_number: "PO-2024-002", quotation_id: 2, start_date: "2024-01-25", end_date: "2024-02-25", priority: "Medium", status: "Pending" },
                    { id: 3, order_number: "PO-2024-003", quotation_id: 3, start_date: "2024-01-28", end_date: "2024-02-28", priority: "Low", status: "Not Started" }
                ],
                relations: {
                    quotation: "id",
                    operation: "production_order_id"
                }
            },
            operation: {
                name: "Operation",
                fields: ["id", "operation_code", "production_order_id", "description", "workcenter", "est_hours", "status"],
                data: [
                    { id: 1, operation_code: "OP-001", production_order_id: 1, description: "Cutting Material", workcenter: "CUT-01", est_hours: 4, status: "Completed" },
                    { id: 2, operation_code: "OP-002", production_order_id: 1, description: "Welding Assembly", workcenter: "WELD-02", est_hours: 8, status: "In Progress" },
                    { id: 3, operation_code: "OP-003", production_order_id: 1, description: "Quality Check", workcenter: "QC-01", est_hours: 2, status: "Pending" },
                    { id: 4, operation_code: "OP-004", production_order_id: 2, description: "Material Preparation", workcenter: "PREP-01", est_hours: 6, status: "Not Started" },
                    { id: 5, operation_code: "OP-005", production_order_id: 3, description: "Initial Assembly", workcenter: "ASSY-01", est_hours: 10, status: "Pending" }
                ],
                relations: {
                    production_order: "id"
                }
            }
        };

        // Application State
        let currentTable = null;
        let selectedRecord = null;
        let relationshipPath = [];

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            renderTableList();
        });

        // Render the list of tables in left panel
        function renderTableList() {
            const tableList = document.getElementById('tableList');
            tableList.innerHTML = '';
            
            Object.keys(database).forEach(tableKey => {
                const table = database[tableKey];
                const li = document.createElement('li');
                li.className = 'table-item';
                li.dataset.table = tableKey;
                li.innerHTML = `
                    <span>${table.name}</span>
                    <span class="table-count">${table.data.length} records</span>
                `;
                
                li.addEventListener('click', () => {
                    selectTable(tableKey);
                });
                
                tableList.appendChild(li);
            });
            
            // Select first table by default
            if (Object.keys(database).length > 0) {
                selectTable(Object.keys(database)[0]);
            }
        }

        // Select a table and show its data
        function selectTable(tableKey) {
            // Update UI state
            document.querySelectorAll('.table-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-table="${tableKey}"]`).classList.add('active');
            
            currentTable = tableKey;
            selectedRecord = null;
            relationshipPath = [tableKey];
            
            // Render table data
            renderTableData();
            
            // Clear right panel
            clearRightPanel();
            
            // Update relationship info
            updateRelationshipInfo();
        }

        // Render the data of selected table
        function renderTableData() {
            const container = document.getElementById('tableDataContainer');
            const table = database[currentTable];
            
            if (!table) return;
            
            let html = `
                <div style="padding: 20px;">
                    <h3 style="margin-bottom: 15px; color: #333;">${table.name} (${table.data.length} records)</h3>
                    <div style="overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
            `;
            
            // Render headers
            table.fields.forEach(field => {
                html += `<th>${field.replace('_', ' ').toUpperCase()}</th>`;
            });
            
            html += `</tr></thead><tbody>`;
            
            // Render data rows
            table.data.forEach((row, index) => {
                html += `<tr data-index="${index}" onclick="selectRecord(${index})">`;
                table.fields.forEach(field => {
                    const value = row[field];
                    // Format the value for display
                    let displayValue = value;
                    if (typeof value === 'number' && field.includes('amount')) {
                        displayValue = `$${value.toLocaleString()}`;
                    } else if (typeof value === 'number' && field.includes('hours')) {
                        displayValue = `${value} hrs`;
                    }
                    
                    html += `<td>${displayValue}</td>`;
                });
                html += `</tr>`;
            });
            
            html += `</tbody></table></div></div>`;
            
            container.innerHTML = html;
        }

        // Select a record from the table
        function selectRecord(index) {
            // Update UI state
            document.querySelectorAll('.data-table tr').forEach(row => {
                row.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            const table = database[currentTable];
            selectedRecord = table.data[index];
            
            // Update relationship path
            if (relationshipPath[relationshipPath.length - 1] !== currentTable) {
                relationshipPath.push(currentTable);
            }
            
            // Render related data in right panel
            renderRelatedData();
            
            // Update relationship info
            updateRelationshipInfo();
        }

        // Render related data in right panel
        function renderRelatedData() {
            const container = document.getElementById('relatedDataContainer');
            const table = database[currentTable];
            
            if (!selectedRecord) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div>ðŸ”—</div>
                        <p>Select a record to view related data</p>
                    </div>
                `;
                return;
            }
            
            // Update right panel title
            document.getElementById('rightPanelTitle').textContent = `ðŸ”— Related to ${table.name} #${selectedRecord.id}`;
            
            let html = `<div class="data-details">`;
            
            // Show details of selected record
            html += `<h3 style="margin-bottom: 15px; color: #333;">Selected Record Details</h3>`;
            html += `<div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">`;
            
            table.fields.forEach(field => {
                const value = selectedRecord[field];
                let displayValue = value;
                
                if (typeof value === 'number' && field.includes('amount')) {
                    displayValue = `$${value.toLocaleString()}`;
                } else if (typeof value === 'number' && field.includes('hours')) {
                    displayValue = `${value} hrs`;
                }
                
                html += `
                    <div class="detail-item">
                        <span class="detail-label">${field.replace('_', ' ').toUpperCase()}</span>
                        <span class="detail-value">${displayValue}</span>
                    </div>
                `;
            });
            
            html += `</div>`;
            
            // Show related tables
            html += `<h3 style="margin-bottom: 15px; color: #333;">Related Tables</h3>`;
            
            const relations = table.relations;
            let hasRelations = false;
            
            Object.keys(relations).forEach(relatedTableKey => {
                const relatedTable = database[relatedTableKey];
                const foreignKey = relations[relatedTableKey];
                
                if (!relatedTable) return;
                
                // Find related records
                const relatedRecords = relatedTable.data.filter(record => {
                    // Check if this record references our selected record
                    if (foreignKey === "id") {
                        // This table references our table by ID
                        const refField = `${currentTable}_id`;
                        return record[refField] === selectedRecord.id;
                    } else {
                        // Our table references this table by ID
                        return selectedRecord[foreignKey] === record.id;
                    }
                });
                
                if (relatedRecords.length > 0) {
                    hasRelations = true;
                    html += `
                        <div style="margin-bottom: 25px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <h4 style="color: #555;">${relatedTable.name} (${relatedRecords.length})</h4>
                                <button onclick="navigateToRelatedTable('${relatedTableKey}', ${selectedRecord.id})" 
                                        style="background: #2196f3; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">
                                    View All
                                </button>
                            </div>
                            <div style="overflow-x: auto;">
                                <table style="width: 100%; border-collapse: collapse;">
                                    <thead>
                                        <tr style="background: #f1f3f4;">
                    `;
                    
                    // Show only first 3 fields for compact view
                    const displayFields = relatedTable.fields.slice(0, 3);
                    displayFields.forEach(field => {
                        html += `<th style="padding: 8px; text-align: left; font-size: 12px;">${field}</th>`;
                    });
                    
                    html += `</tr></thead><tbody>`;
                    
                    // Show only first 3 related records
                    relatedRecords.slice(0, 3).forEach(record => {
                        html += `<tr style="border-bottom: 1px solid #eee; cursor: pointer;" onclick="viewRelatedRecord('${relatedTableKey}', ${record.id})">`;
                        displayFields.forEach(field => {
                            html += `<td style="padding: 8px; font-size: 12px;">${record[field]}</td>`;
                        });
                        html += `</tr>`;
                    });
                    
                    if (relatedRecords.length > 3) {
                        html += `
                            <tr>
                                <td colspan="${displayFields.length}" style="padding: 8px; text-align: center; font-style: italic; color: #999; font-size: 12px;">
                                    ... and ${relatedRecords.length - 3} more
                                </td>
                            </tr>
                        `;
                    }
                    
                    html += `</tbody></table></div></div>`;
                }
            });
            
            if (!hasRelations) {
                html += `
                    <div style="text-align: center; padding: 20px; color: #999;">
                        No related records found for this selection
                    </div>
                `;
            }
            
            html += `</div>`;
            container.innerHTML = html;
        }

        // Navigate to a related table
        function navigateToRelatedTable(tableKey, sourceId) {
            // Add to relationship path
            if (relationshipPath[relationshipPath.length - 1] !== tableKey) {
                relationshipPath.push(tableKey);
            }
            
            // Select the table
            selectTable(tableKey);
            
            // Highlight the record that's related to source
            setTimeout(() => {
                const table = database[tableKey];
                const sourceTable = database[currentTable];
                const relationField = sourceTable.relations[tableKey];
                
                if (relationField) {
                    // Find the record that matches
                    const index = table.data.findIndex(record => {
                        if (relationField === "id") {
                            const refField = `${currentTable}_id`;
                            return record[refField] === sourceId;
                        } else {
                            return record.id === sourceTable.data.find(r => r.id === sourceId)[relationField];
                        }
                    });
                    
                    if (index !== -1) {
                        // Simulate click on the related record
                        const rows = document.querySelectorAll('.data-table tr[data-index]');
                        if (rows[index]) {
                            rows[index].click();
                        }
                    }
                }
            }, 100);
            
            updateRelationshipInfo();
        }

        // View details of a related record
        function viewRelatedRecord(tableKey, recordId) {
            navigateToRelatedTable(tableKey, recordId);
        }

        // Update relationship path display
        function updateRelationshipInfo() {
            const container = document.getElementById('relationshipInfo');
            const pathContainer = document.getElementById('relationshipPath');
            
            if (relationshipPath.length <= 1) {
                container.style.display = 'none';
                return;
            }
            
            container.style.display = 'block';
            
            let pathHTML = '';
            relationshipPath.forEach((tableKey, index) => {
                const table = database[tableKey];
                pathHTML += `<span class="path-item">${table.name}</span>`;
                
                if (index < relationshipPath.length - 1) {
                    pathHTML += `<span class="path-arrow">â†’</span>`;
                }
            });
            
            pathContainer.innerHTML = pathHTML;
        }

        // Clear right panel
        function clearRightPanel() {
            const container = document.getElementById('relatedDataContainer');
            container.innerHTML = `
                <div class="empty-state">
                    <div>ðŸ”—</div>
                    <p>Select a record to view related data</p>
                </div>
            `;
            document.getElementById('rightPanelTitle').textContent = 'ðŸ”— Related Data';
        }

        // Make functions available globally for onclick events
        window.selectRecord = selectRecord;
        window.navigateToRelatedTable = navigateToRelatedTable;
        window.viewRelatedRecord = viewRelatedRecord;
    </script>
</body>
</html>